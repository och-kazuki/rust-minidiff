## 1. 目的・スコープ

* 2つの入力（ファイル/標準入力）を比較して**差分を人間が読みやすく表示**する
* 初期は**テキストの行単位diff**に限定（バイナリは対象外）

---

## 2. 入力要件

### 2.1 入力ソース

* 基本: `minidiff <pathA> <pathB>`
* 追加（任意）: `-` を指定した場合は標準入力から読む

  * 例: `minidiff - <pathB>` / `minidiff <pathA> -`
* 入力エンコーディング

  * UTF-8を前提
  * UTF-8でない場合はエラー（「非UTF-8の可能性」メッセージ）

### 2.2 前処理オプション

* `--ignore-eol`：改行コード差（LF/CRLF）を無視
* `--ignore-trailing-space`：行末空白を無視
* `--ignore-case`：大文字小文字を無視
* `--trim`：行全体の前後空白を無視（必要なら）

---

## 3. 差分計算要件

### 3.1 比較単位

* 行単位で比較（1行 = `\n`区切り）
* 差分の種別は以下

  * **Equal**（同一）
  * **Add**（Bに追加）
  * **Remove**（Aから削除）
  * **Change**（AとBで異なる：実装上はRemove+Addでもよいが、表示上はChange扱いできると良い）

### 3.2 アルゴリズム（要件としての制約）

* 初版はO(N*M)でも可（教育目的）
* ただし、大きいファイルへの安全策を設ける

  * `--max-lines`（上限超えはエラーor警告）
  * もしくは `--fast`（簡易アルゴリズムに切替）

---

## 4. 出力要件（表示）

### 4.1 出力形式

* デフォルト: **Unified diff風**

  * ヘッダ（任意）: `--- A`, `+++ B`
  * ハンク単位で表示（最初はハンク分割なしでも可、後で追加）
* 行プレフィックス

  * 変更なし: `" "`（スペース）
  * 追加: `"+"`
  * 削除: `"-"`

### 4.2 表示オプション

* `--color=auto|always|never`

  * auto: TTYなら色、パイプなら無色
* `--context <n>`：変更の前後n行だけ出す（デフォルト3）
* `--no-header`：ヘッダ非表示
* `--line-numbers`：行番号表示（A/Bそれぞれ）

  * 例: ` 12| 12  同一行`
  * 追加/削除時の片側は `-` 表示

### 4.3 文字数/改行の扱い

* 長すぎる行の省略

  * `--max-line-length <n>`（超えたら `…` で省略）
* 最終行の改行有無を検知し、必要なら注意表示

  * 例: `\ No newline at end of file` 相当（任意）

---

## 5. CLI（コマンドライン）要件

* `--help`：使い方/オプション表示
* `--version`：バージョン表示
* 終了コード

  * `0`: 差分なし
  * `1`: 差分あり
  * `2`: エラー（読み込み失敗/不正引数/UTF-8不正など）

---

## 6. エラー処理要件

* ファイルが存在しない/権限不足 → 明確なメッセージ
* ディレクトリを渡された → エラー（将来はディレクトリ比較に拡張可）
* 巨大入力でメモリ不足になりそう → 上限や警告で回避

---

## 7. 非機能要件（最低限）

* クロスプラットフォーム（Windows/macOS/Linux）で動作
* 目標性能（目安）

  * 数千行〜数万行程度をストレスなく表示
* テスト

  * 差分種別（equal/add/remove/change）
  * オプション（ignore系、context、line-numbers）
  * 終了コード

---

## 8. 将来拡張（今回は必須じゃなか）

* ハンク分割（連続する変更をまとめて表示）
* 単語単位/文字単位のハイライト（Changeの中身）
* ディレクトリ比較（再帰、除外パターン）
* `--output json` など機械処理向け出力

